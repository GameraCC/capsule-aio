'use strict';

// Stanford Javascript Crypto Library (http://crypto.stanford.edu/sjcl/)
function t(t,e,i){if(4!==e.length)throw new sjcl.exception.invalid("invalid aes block size");var n=t.b[i],r=e[0]^n[0],s=e[i?3:1]^n[1],o=e[2]^n[2];e=e[i?1:3]^n[3];var c,a,h,l,u=n.length/4-2,d=4,f=[0,0,0,0];c=t.l[i],t=c[0];var p=c[1],m=c[2],g=c[3],y=c[4];for(l=0;u>l;l++)c=t[r>>>24]^p[s>>16&255]^m[o>>8&255]^g[255&e]^n[d],a=t[s>>>24]^p[o>>16&255]^m[e>>8&255]^g[255&r]^n[d+1],h=t[o>>>24]^p[e>>16&255]^m[r>>8&255]^g[255&s]^n[d+2],e=t[e>>>24]^p[r>>16&255]^m[s>>8&255]^g[255&o]^n[d+3],d+=4,r=c,s=a,o=h;for(l=0;4>l;l++)f[i?3&-l:l]=y[r>>>24]<<24^y[s>>16&255]<<16^y[o>>8&255]<<8^y[255&e]^n[d++],c=r,r=s,s=o,o=e,e=c;return f}function u(t,e){var i,n,r,s=t.u,o=t.b,c=s[0],a=s[1],h=s[2],l=s[3],u=s[4],d=s[5],f=s[6],p=s[7];for(i=0;64>i;i++)16>i?n=e[i]:(n=e[i+1&15],r=e[i+14&15],n=e[15&i]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+e[15&i]+e[i+9&15]|0),n=n+p+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(f^u&(d^f))+o[i],p=f,f=d,d=u,u=l+n|0,l=h,h=a,a=c,c=n+(a&h^l&(a^h))+(a>>>2^a>>>13^a>>>22^a<<30^a<<19^a<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+a|0,s[2]=s[2]+h|0,s[3]=s[3]+l|0,s[4]=s[4]+u|0,s[5]=s[5]+d|0,s[6]=s[6]+f|0,s[7]=s[7]+p|0}function A(t,e){var i,n=sjcl.random.C[t],r=[];for(i in n)n.hasOwnProperty(i)&&r.push(n[i]);for(i=0;i<r.length;i++)r[i](e)}function C(t,e){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?t.addEntropy(window.performance.now(),e,"loadtime"):t.addEntropy((new Date).valueOf(),e,"loadtime")}function y(t){t.b=z(t).concat(z(t)),t.D=new sjcl.cipher.aes(t.b)}function z(t){for(var e=0;4>e&&(t.g[e]=t.g[e]+1|0,!t.g[e]);e++);return t.D.encrypt(t.g)}function B(t,e){return function(){e.apply(t,arguments)}}var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};sjcl.cipher.aes=function(t){this.l[0][0][0]||this.H();var e,i,n,r,s=this.l[0][4],o=this.l[1];e=t.length;var c=1;if(4!==e&&6!==e&&8!==e)throw new sjcl.exception.invalid("invalid aes key size");for(this.b=[n=t.slice(0),r=[]],t=e;4*e+28>t;t++)i=n[t-1],(0===t%e||8===e&&4===t%e)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[255&i],0===t%e&&(i=i<<8^i>>>24^c<<24,c=c<<1^283*(c>>7))),n[t]=n[t-e]^i;for(e=0;t;e++,t--)i=n[3&e?t:t-4],r[e]=4>=t||4>e?i:o[0][s[i>>>24]]^o[1][s[i>>16&255]]^o[2][s[i>>8&255]]^o[3][s[255&i]]},sjcl.cipher.aes.prototype={encrypt:function(e){return t(this,e,0)},decrypt:function(e){return t(this,e,1)},l:[[[],[],[],[],[]],[[],[],[],[],[]]],H:function(){var t,e,i,n,r,s,o,c=this.l[0],a=this.l[1],h=c[4],l=a[4],u=[],d=[];for(t=0;256>t;t++)d[(u[t]=t<<1^283*(t>>7))^t]=t;for(e=i=0;!h[e];e^=n||1,i=d[i]||1)for(s=i^i<<1^i<<2^i<<3^i<<4,s=s>>8^255&s^99,h[e]=s,l[s]=e,r=u[t=u[n=u[e]]],o=16843009*r^65537*t^257*n^16843008*e,r=257*u[s]^16843008*s,t=0;4>t;t++)c[t][e]=r=r<<24^r>>>8,a[t][s]=o=o<<24^o>>>8;for(t=0;5>t;t++)c[t]=c[t].slice(0),a[t]=a[t].slice(0)}},sjcl.bitArray={bitSlice:function(t,e,i){return t=sjcl.bitArray.S(t.slice(e/32),32-(31&e)).slice(1),void 0===i?t:sjcl.bitArray.clamp(t,i-e)},extract:function(t,e,i){var n=Math.floor(-e-i&31);return(-32&(e+i-1^e)?t[e/32|0]<<32-n^t[e/32+1|0]>>>n:t[e/32|0]>>>n)&(1<<i)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var i=t[t.length-1],n=sjcl.bitArray.getPartial(i);return 32===n?t.concat(e):sjcl.bitArray.S(e,n,0|i,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+sjcl.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var i=t.length;return e=31&e,i>0&&e&&(t[i-1]=sjcl.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return 32===t?e:(i?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return!1;var i,n=0;for(i=0;i<t.length;i++)n|=t[i]^e[i];return 0===n},S:function(t,e,i,n){var r;for(r=0,void 0===n&&(n=[]);e>=32;e-=32)n.push(i),i=0;if(0===e)return n.concat(t);for(r=0;r<t.length;r++)n.push(i|t[r]>>>e),i=t[r]<<32-e;return r=t.length?t[t.length-1]:0,t=sjcl.bitArray.getPartial(r),n.push(sjcl.bitArray.partial(e+t&31,e+t>32?i:n.pop(),1)),n},J:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,i;for(e=0;e<t.length;++e)i=t[e],t[e]=i>>>24|i>>>8&65280|(65280&i)<<8|i<<24;return t}},sjcl.codec.utf8String={fromBits:function(t){var e,i,n="",r=sjcl.bitArray.bitLength(t);for(e=0;r/8>e;e++)0===(3&e)&&(i=t[e/4]),n+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,i=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3===(3&e)&&(i.push(n),n=0);return 3&e&&i.push(sjcl.bitArray.partial(8*(3&e),n)),i}},sjcl.codec.base64={L:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,i){var n="",r=0,s=sjcl.codec.base64.L,o=0,c=sjcl.bitArray.bitLength(t);for(i&&(s=s.substr(0,62)+"-_"),i=0;6*n.length<c;)n+=s.charAt((o^t[i]>>>r)>>>26),6>r?(o=t[i]<<6-r,r+=26,i++):(o<<=6,r-=6);for(;3&n.length&&!e;)n+="=";return n},toBits:function(t,e){t=t.replace(/\s|=/g,"");var i,n,r=[],s=0,o=sjcl.codec.base64.L,c=0;for(e&&(o=o.substr(0,62)+"-_"),i=0;i<t.length;i++){if(n=o.indexOf(t.charAt(i)),0>n)throw new sjcl.exception.invalid("this isn't base64!");s>26?(s-=26,r.push(c^n>>>s),c=n<<32-s):(s+=6,c^=n<<32-s)}return 56&s&&r.push(sjcl.bitArray.partial(56&s,c,1)),r}},sjcl.codec.base64url={fromBits:function(t){return sjcl.codec.base64.fromBits(t,1,1)},toBits:function(t){return sjcl.codec.base64.toBits(t,1)}},sjcl.codec.bytes={fromBits:function(t){var e,i,n=[],r=sjcl.bitArray.bitLength(t);for(e=0;r/8>e;e++)0===(3&e)&&(i=t[e/4]),n.push(i>>>24),i<<=8;return n},toBits:function(t){var e,i=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t[e],3===(3&e)&&(i.push(n),n=0);return 3&e&&i.push(sjcl.bitArray.partial(8*(3&e),n)),i}},sjcl.hash.sha256=function(t){this.b[0]||this.H(),t?(this.u=t.u.slice(0),this.o=t.o.slice(0),this.h=t.h):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this.u=this.P.slice(0),this.o=[],this.h=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,i=this.o=sjcl.bitArray.concat(this.o,t);if(e=this.h,t=this.h=e+sjcl.bitArray.bitLength(t),t>9007199254740991)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var n=new Uint32Array(i),r=0;for(e=512+e-(512+e&511);t>=e;e+=512)u(this,n.subarray(16*r,16*(r+1))),r+=1;i.splice(0,16*r)}else for(e=512+e-(512+e&511);t>=e;e+=512)u(this,i.splice(0,16));return this},finalize:function(){var t,e=this.o,i=this.u,e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]);for(t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.h/4294967296)),e.push(0|this.h);e.length;)u(this,e.splice(0,16));return this.reset(),i},P:[],b:[],H:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}for(var e,i,n=0,r=2;64>n;r++){for(i=!0,e=2;r>=e*e;e++)if(0===r%e){i=!1;break}i&&(8>n&&(this.P[n]=t(Math.pow(r,.5))),this.b[n]=t(Math.pow(r,1/3)),n++)}}},sjcl.mode.ccm={name:"ccm",v:[],listenProgress:function(t){sjcl.mode.ccm.v.push(t)},unListenProgress:function(t){t=sjcl.mode.ccm.v.indexOf(t),t>-1&&sjcl.mode.ccm.v.splice(t,1)},X:function(t){var e,i=sjcl.mode.ccm.v.slice();for(e=0;e<i.length;e+=1)i[e](t)},encrypt:function(t,e,i,n,r){var s,o=e.slice(0),c=sjcl.bitArray,a=c.bitLength(i)/8,h=c.bitLength(o)/8;if(r=r||64,n=n||[],7>a)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;4>s&&h>>>8*s;s++);return 15-a>s&&(s=15-a),i=c.clamp(i,8*(15-s)),e=sjcl.mode.ccm.N(t,e,i,n,r,s),o=sjcl.mode.ccm.O(t,o,i,e,r,s),c.concat(o.data,o.tag)},decrypt:function(t,e,i,n,r){r=r||64,n=n||[];var s=sjcl.bitArray,o=s.bitLength(i)/8,c=s.bitLength(e),a=s.clamp(e,c-r),h=s.bitSlice(e,c-r),c=(c-r)/8;if(7>o)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&c>>>8*e;e++);if(15-o>e&&(e=15-o),i=s.clamp(i,8*(15-e)),a=sjcl.mode.ccm.O(t,a,i,h,r,e),t=sjcl.mode.ccm.N(t,a.data,i,n,r,e),!s.equal(a.tag,t))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return a.data},ba:function(t,e,i,n,r,s){var o=[],c=sjcl.bitArray,a=c.J;if(n=[c.partial(8,(e.length?64:0)|n-2<<2|s-1)],n=c.concat(n,i),n[3]|=r,n=t.encrypt(n),e.length)for(i=c.bitLength(e)/8,65279>=i?o=[c.partial(16,i)]:4294967295>=i&&(o=c.concat([c.partial(16,65534)],[i])),o=c.concat(o,e),e=0;e<o.length;e+=4)n=t.encrypt(a(n,o.slice(e,e+4).concat([0,0,0])));return n},N:function(t,e,i,n,r,s){var o=sjcl.bitArray,c=o.J;if(r/=8,r%2||4>r||r>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<n.length||4294967295<e.length)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");for(i=sjcl.mode.ccm.ba(t,n,i,r,o.bitLength(e)/8,s),n=0;n<e.length;n+=4)i=t.encrypt(c(i,e.slice(n,n+4).concat([0,0,0])));return o.clamp(i,8*r)},O:function(t,e,i,n,r,s){var o,c=sjcl.bitArray;o=c.J;var a=e.length,h=c.bitLength(e),l=a/50,u=l;if(i=c.concat([c.partial(8,s-1)],i).concat([0,0,0]).slice(0,4),n=c.bitSlice(o(n,t.encrypt(i)),0,r),!a)return{tag:n,data:[]};for(o=0;a>o;o+=4)o>l&&(sjcl.mode.ccm.X(o/a),l+=u),i[3]++,r=t.encrypt(i),e[o]^=r[0],e[o+1]^=r[1],e[o+2]^=r[2],e[o+3]^=r[3];return{tag:n,data:c.clamp(e,h)}}},sjcl.prng=function(t){this.c=[new sjcl.hash.sha256],this.i=[0],this.I=0,this.w={},this.G=0,this.M={},this.R=this.f=this.j=this.Z=0,this.b=[0,0,0,0,0,0,0,0],this.g=[0,0,0,0],this.D=void 0,this.F=t,this.s=!1,this.C={progress:{},seeded:{}},this.m=this.Y=0,this.A=1,this.B=2,this.U=65536,this.K=[0,48,64,96,128,192,256,384,512,768,1024],this.V=3e4,this.T=80},sjcl.prng.prototype={randomWords:function(t,e){var i,n=[];i=this.isReady(e);var r;if(i===this.m)throw new sjcl.exception.notReady("generator isn't seeded");if(i&this.B){i=!(i&this.A),r=[];var s,o=0;for(this.R=r[0]=(new Date).valueOf()+this.V,s=0;16>s;s++)r.push(4294967296*Math.random()|0);for(s=0;s<this.c.length&&(r=r.concat(this.c[s].finalize()),o+=this.i[s],this.i[s]=0,i||!(this.I&1<<s));s++);for(this.I>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.i.push(0)),this.f-=o,o>this.j&&(this.j=o),this.I++,this.b=sjcl.hash.sha256.hash(this.b.concat(r)),this.D=new sjcl.cipher.aes(this.b),i=0;4>i&&(this.g[i]=this.g[i]+1|0,!this.g[i]);i++);}for(i=0;t>i;i+=4)0===(i+1)%this.U&&y(this),r=z(this),n.push(r[0],r[1],r[2],r[3]);return y(this),n.slice(0,t)},setDefaultParanoia:function(t,e){if(0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==e)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.F=t},addEntropy:function(t,e,i){i=i||"user";var n,r,s=(new Date).valueOf(),o=this.w[i],c=this.isReady(),a=0;switch(n=this.M[i],void 0===n&&(n=this.M[i]=this.Z++),void 0===o&&(o=this.w[i]=0),this.w[i]=(this.w[i]+1)%this.c.length,typeof t){case"number":void 0===e&&(e=1),this.c[o].update([n,this.G++,1,e,s,1,0|t]);break;case"object":if(i=Object.prototype.toString.call(t),"[object Uint32Array]"===i){for(r=[],i=0;i<t.length;i++)r.push(t[i]);t=r}else for("[object Array]"!==i&&(a=1),i=0;i<t.length&&!a;i++)"number"!=typeof t[i]&&(a=1);if(!a){if(void 0===e)for(i=e=0;i<t.length;i++)for(r=t[i];r>0;)e++,r>>>=1;this.c[o].update([n,this.G++,2,e,s,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this.c[o].update([n,this.G++,3,e,s,t.length]),this.c[o].update(t);break;default:a=1}if(a)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.i[o]+=e,this.f+=e,c===this.m&&(this.isReady()!==this.m&&A("seeded",Math.max(this.j,this.f)),A("progress",this.getProgress()))},isReady:function(t){return t=this.K[void 0!==t?t:this.F],this.j&&this.j>=t?this.i[0]>this.T&&(new Date).valueOf()>this.R?this.B|this.A:this.A:this.f>=t?this.B|this.m:this.m},getProgress:function(t){return t=this.K[t?t:this.F],this.j>=t?1:this.f>t?1:this.f/t},startCollectors:function(){if(!this.s){if(this.a={loadTimeCollector:B(this,this.aa),mouseCollector:B(this,this.ca),keyboardCollector:B(this,this.$),accelerometerCollector:B(this,this.W),touchCollector:B(this,this.da)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can't attach event");document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)}this.s=!0}},stopCollectors:function(){this.s&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.s=!1)},addEventListener:function(t,e){this.C[t][this.Y++]=e},removeEventListener:function(t,e){var i,n,r=this.C[t],s=[];for(n in r)r.hasOwnProperty(n)&&r[n]===e&&s.push(n);for(i=0;i<s.length;i++)n=s[i],delete r[n]},$:function(){C(this,1)},ca:function(t){var e,i;try{e=t.x||t.clientX||t.offsetX||0,i=t.y||t.clientY||t.offsetY||0}catch(n){i=e=0}0!=e&&0!=i&&this.addEntropy([e,i],2,"mouse"),C(this,0)},da:function(t){t=t.touches[0]||t.changedTouches[0],this.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),C(this,0)},aa:function(){C(this,2)},W:function(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;"number"==typeof e&&this.addEntropy(e,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),C(this,0)}},sjcl.random=new sjcl.prng(6);t:try{var D,E,F,G;if(G="undefined"!=typeof module&&module.exports){var H;try{H=require("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(F=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break t;window.msCrypto.getRandomValues(F)}sjcl.random.addEntropy(F,1024,"crypto['getRandomValues']")}}catch(a){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),"function"==typeof define&&define([],function(){return sjcl});

/**
 * Adyen client side card encryption implementation
 * 
 * @constructor 
 * 
 * @param {string} key - Pipe delimited modulus and exponent provided by adyen to derive a key from
 * @param {"0_1_25" | "0_1_21" | "0_1_18"} version - Version to be concatenated 
 */
class AdyenEncrypt {
    constructor({key, version}) {
        const _key = key.split("|");
        this.mod = _key[1]
        this.exp = _key[0]
        this.version = version
    }

    // RSA and ECC in JavaScript (http://www-cs-students.stanford.edu/~tjw/jsbn/)
    rsaEncrypt=(t,i,s)=>{function T(t,i,s){null!=t&&("number"==typeof t?this.fromNumber(t,i,s):null==i&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,i))}function D(){return new T(null)}function o(t,i,s,o,r,h){for(var n=16383&i,e=i>>14;0<=--h;){var u=16383&this[t],f=this[t++]>>14,p=e*u+f*n;r=((u=n*u+((16383&p)<<14)+s[o]+r)>>28)+(p>>14)+e*f,s[o++]=268435455&u}return r}T.prototype.am=o,T.prototype.DB=Q=28,T.prototype.DM=(1<<Q)-1,T.prototype.DV=1<<Q;T.prototype.FV=Math.pow(2,52),T.prototype.F1=52-Q,T.prototype.F2=2*Q-52;var r="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array;for(st="0".charCodeAt(0),ot=0;ot<=9;++ot)h[st++]=ot;for(st="a".charCodeAt(0),ot=10;ot<36;++ot)h[st++]=ot;for(st="A".charCodeAt(0),ot=10;ot<36;++ot)h[st++]=ot;function u(t){return r.charAt(t)}function e(t,i){i=h[t.charCodeAt(i)];return null==i?-1:i}function n(t){for(var i=this.t-1;0<=i;--i)t[i]=this[i];t.t=this.t,t.s=this.s}function f(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function p(t){var i=D();return i.fromInt(t),i}function a(t,i){var s;if(16==i)s=4;else if(8==i)s=3;else if(256==i)s=8;else if(2==i)s=1;else if(32==i)s=5;else{if(4!=i)return void this.fromRadix(t,i);s=2}this.t=0,this.s=0;for(var o=t.length,r=!1,h=0;0<=--o;){var n=8==s?255&t[o]:function(t,i){i=h[t.charCodeAt(i)];return null==i?-1:i}(t,o);n<0?"-"==t.charAt(o)&&(r=!0):(r=!1,0==h?this[this.t++]=n:h+s>this.DB?(this[this.t-1]|=(n&(1<<this.DB-h)-1)<<h,this[this.t++]=n>>this.DB-h):this[this.t-1]|=n<<h,(h+=s)>=this.DB&&(h-=this.DB))}8==s&&0!=(128&t[0])&&(this.s=-1,0<h&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),r&&T.ZERO.subTo(this,this)}function l(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t}function c(t){if(this.s<0)return"-"+this.negate().toString(t);var i;if(16==t)i=4;else if(8==t)i=3;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return this.toRadix(t);i=2}var s,o=(1<<i)-1,r=!1,h="",n=this.t,e=this.DB-n*this.DB%i;if(0<n--)for(e<this.DB&&0<(s=this[n]>>e)&&(r=!0,h=u(s));0<=n;)e<i?(s=(this[n]&(1<<e)-1)<<i-e,s|=this[--n]>>(e+=this.DB-i)):(s=this[n]>>(e-=i)&o,e<=0&&(e+=this.DB,--n)),0<s&&(r=!0),r&&(h+=u(s));return r?h:"0"}function m(){var t=D();return T.ZERO.subTo(this,t),t}function v(){return this.s<0?this.negate():this}function y(t){var i=this.s-t.s;if(0!=i)return i;var s=this.t;if(0!=(i=s-t.t))return this.s<0?-i:i;for(;0<=--s;)if(0!=(i=this[s]-t[s]))return i;return 0}function d(t){var i,s=1;return 0!=(i=t>>>16)&&(t=i,s+=16),0!=(i=t>>8)&&(t=i,s+=8),0!=(i=t>>4)&&(t=i,s+=4),0!=(i=t>>2)&&(t=i,s+=2),0!=(i=t>>1)&&(t=i,s+=1),s}function b(){return this.t<=0?0:this.DB*(this.t-1)+d(this[this.t-1]^this.s&this.DM)}function S(t,i){for(var s=this.t-1;0<=s;--s)i[s+t]=this[s];for(s=t-1;0<=s;--s)i[s]=0;i.t=this.t+t,i.s=this.s}function B(t,i){for(var s=t;s<this.t;++s)i[s-t]=this[s];i.t=Math.max(this.t-t,0),i.s=this.s}function g(t,i){for(var s=t%this.DB,o=this.DB-s,r=(1<<o)-1,h=Math.floor(t/this.DB),n=this.s<<s&this.DM,e=this.t-1;0<=e;--e)i[e+h+1]=this[e]>>o|n,n=(this[e]&r)<<s;for(e=h-1;0<=e;--e)i[e]=0;i[h]=n,i.t=this.t+h+1,i.s=this.s,i.clamp()}function M(t,i){i.s=this.s;var s=Math.floor(t/this.DB);if(s>=this.t)i.t=0;else{var o=t%this.DB,r=this.DB-o,h=(1<<o)-1;i[0]=this[s]>>o;for(var n=s+1;n<this.t;++n)i[n-s-1]|=(this[n]&h)<<r,i[n-s]=this[n]>>o;0<o&&(i[this.t-s-1]|=(this.s&h)<<r),i.t=this.t-s,i.clamp()}}function R(t,i){for(var s=0,o=0,r=Math.min(t.t,this.t);s<r;)o+=this[s]-t[s],i[s++]=o&this.DM,o>>=this.DB;if(t.t<this.t){for(o-=t.s;s<this.t;)o+=this[s],i[s++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;s<t.t;)o-=t[s],i[s++]=o&this.DM,o>>=this.DB;o-=t.s}i.s=o<0?-1:0,o<-1?i[s++]=this.DV+o:0<o&&(i[s++]=o),i.t=s,i.clamp()}function A(t,i){var s=this.abs(),o=t.abs(),r=s.t;for(i.t=r+o.t;0<=--r;)i[r]=0;for(r=0;r<o.t;++r)i[r+s.t]=s.am(0,o[r],i,r,0,s.t);i.s=0,i.clamp(),this.s!=t.s&&T.ZERO.subTo(i,i)}function E(t){for(var i=this.abs(),s=t.t=2*i.t;0<=--s;)t[s]=0;for(s=0;s<i.t-1;++s){var o=i.am(s,i[s],t,2*s,0,1);(t[s+i.t]+=i.am(s+1,2*i[s],t,2*s+1,o,i.t-s-1))>=i.DV&&(t[s+i.t]-=i.DV,t[s+i.t+1]=1)}0<t.t&&(t[t.t-1]+=i.am(s,i[s],t,2*s,0,1)),t.s=0,t.clamp()}function V(t,i,s){var o=t.abs();if(!(o.t<=0)){var r=this.abs();if(r.t<o.t)return null!=i&&i.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=D());var h=D(),n=this.s,e=t.s,t=this.DB-d(o[o.t-1]);0<t?(o.lShiftTo(t,h),r.lShiftTo(t,s)):(o.copyTo(h),r.copyTo(s));var u=h.t,f=h[u-1];if(0!=f){var r=f*(1<<this.F1)+(1<u?h[u-2]>>this.F2:0),p=this.FV/r,a=(1<<this.F1)/r,l=1<<this.F2,c=s.t,m=c-u,v=null==i?D():i;for(h.dlShiftTo(m,v),0<=s.compareTo(v)&&(s[s.t++]=1,s.subTo(v,s)),T.ONE.dlShiftTo(u,v),v.subTo(h,h);h.t<u;)h[h.t++]=0;for(;0<=--m;){var y=s[--c]==f?this.DM:Math.floor(s[c]*p+(s[c-1]+l)*a);if((s[c]+=h.am(0,y,s,m,0,u))<y)for(h.dlShiftTo(m,v),s.subTo(v,s);s[c]<--y;)s.subTo(v,s)}null!=i&&(s.drShiftTo(u,i),n!=e&&T.ZERO.subTo(i,i)),s.t=u,s.clamp(),0<t&&s.rShiftTo(t,s),n<0&&T.ZERO.subTo(s,s)}}}function w(t){var i=D();return this.abs().divRemTo(t,null,i),this.s<0&&0<i.compareTo(T.ZERO)&&t.subTo(i,i),i}function O(t){this.m=t}function q(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t}function x(t){return t}function F(t){t.divRemTo(this.m,null,t)}function Z(t,i,s){t.multiplyTo(i,s),this.reduce(s)}function I(t,i){t.squareTo(i),this.reduce(i)}function C(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var i=3&t;return 0<(i=(i=(i=(i=i*(2-(15&t)*i)&15)*(2-(255&t)*i)&255)*(2-((65535&t)*i&65535))&65535)*(2-t*i%this.DV)%this.DV)?this.DV-i:-i}function j(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function N(t){var i=D();return t.abs().dlShiftTo(this.m.t,i),i.divRemTo(this.m,null,i),t.s<0&&0<i.compareTo(T.ZERO)&&this.m.subTo(i,i),i}function P(t){var i=D();return t.copyTo(i),this.reduce(i),i}function k(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var i=0;i<this.m.t;++i){var s=32767&t[i],o=s*this.mpl+((s*this.mph+(t[i]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[s=i+this.m.t]+=this.m.am(0,o,t,i,0,this.m.t);t[s]>=t.DV;)t[s]-=t.DV,t[++s]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)}function L(t,i){t.squareTo(i),this.reduce(i)}function z(t,i,s){t.multiplyTo(i,s),this.reduce(s)}function _(){return 0==(0<this.t?1&this[0]:this.s)}function G(t,i){if(4294967295<t||t<1)return T.ONE;var s,o=D(),r=D(),h=i.convert(this),n=d(t)-1;for(h.copyTo(o);0<=--n;)i.sqrTo(o,r),0<(t&1<<n)?i.mulTo(r,h,o):(s=o,o=r,r=s);return i.revert(o)}function H(t,i){i=new(t<256||i.isEven()?O:j)(i);return this.exp(t,i)}function J(){this.i=0,this.j=0,this.S=new Array}O.prototype.convert=q,O.prototype.revert=x,O.prototype.reduce=F,O.prototype.mulTo=Z,O.prototype.sqrTo=I,j.prototype.convert=N,j.prototype.revert=P,j.prototype.reduce=k,j.prototype.mulTo=z,j.prototype.sqrTo=L,T.prototype.copyTo=n,T.prototype.fromInt=f,T.prototype.fromString=a,T.prototype.clamp=l,T.prototype.dlShiftTo=S,T.prototype.drShiftTo=B,T.prototype.lShiftTo=g,T.prototype.rShiftTo=M,T.prototype.subTo=R,T.prototype.multiplyTo=A,T.prototype.squareTo=E,T.prototype.divRemTo=V,T.prototype.invDigit=C,T.prototype.isEven=_,T.prototype.exp=G,T.prototype.toString=c,T.prototype.negate=m,T.prototype.abs=v,T.prototype.compareTo=y,T.prototype.bitLength=b,T.prototype.mod=w,T.prototype.modPowInt=H,T.ZERO=p(0),T.ONE=p(1),J.prototype.init=function(t){for(var i,s,o=0;o<256;++o)this.S[o]=o;for(o=i=0;o<256;++o)i=i+this.S[o]+t[o%t.length]&255,s=this.S[o],this.S[o]=this.S[i],this.S[i]=s;this.i=0,this.j=0},J.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var K,Q,U=256;function W(){var t;t=(new Date).getTime(),Y[$++]^=255&t,Y[$++]^=t>>8&255,Y[$++]^=t>>16&255,Y[$++]^=t>>24&255,U<=$&&($-=U)}if(null==Y){for(var X,Y=new Array,$=0;$<U;)X=Math.floor(65536*Math.random()),Y[$++]=X>>>8,Y[$++]=255&X;$=0,W()}function tt(){if(null==K){for(W(),(K=new J).init(Y),$=0;$<Y.length;++$)Y[$]=0;$=0}return K.next()}function it(){}it.prototype.nextBytes=function(t){for(var i=0;i<t.length;++i)t[i]=tt()};function T(t,i,s){null!=t&&("number"==typeof t?this.fromNumber(t,i,s):null==i&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,i))}function D(){return new T(null)}function o(t,i,s,o,r,h){for(var n=16383&i,e=i>>14;0<=--h;){var u=16383&this[t],f=this[t++]>>14,p=e*u+f*n;r=((u=n*u+((16383&p)<<14)+s[o]+r)>>28)+(p>>14)+e*f,s[o++]=268435455&u}return r}T.prototype.am=o,T.prototype.DB=Q=28,T.prototype.DM=(1<<Q)-1,T.prototype.DV=1<<Q;T.prototype.FV=Math.pow(2,52),T.prototype.F1=52-Q,T.prototype.F2=2*Q-52;var st,ot,r="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array;for(st="0".charCodeAt(0),ot=0;ot<=9;++ot)h[st++]=ot;for(st="a".charCodeAt(0),ot=10;ot<36;++ot)h[st++]=ot;for(st="A".charCodeAt(0),ot=10;ot<36;++ot)h[st++]=ot;function u(t){return r.charAt(t)}function e(t,i){var i=h[t.charCodeAt(i)];return null==i?-1:i}function n(t){for(var i=this.t-1;0<=i;--i)t[i]=this[i];t.t=this.t,t.s=this.s}function f(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function p(t){var i=D();return i.fromInt(t),i}function a(t,i){var s;if(16==i)s=4;else if(8==i)s=3;else if(256==i)s=8;else if(2==i)s=1;else if(32==i)s=5;else{if(4!=i)return void this.fromRadix(t,i);s=2}this.t=0,this.s=0;for(var o=t.length,r=!1,h=0;0<=--o;){var n=8==s?255&t[o]:e(t,o);n<0?"-"==t.charAt(o)&&(r=!0):(r=!1,0==h?this[this.t++]=n:h+s>this.DB?(this[this.t-1]|=(n&(1<<this.DB-h)-1)<<h,this[this.t++]=n>>this.DB-h):this[this.t-1]|=n<<h,(h+=s)>=this.DB&&(h-=this.DB))}8==s&&0!=(128&t[0])&&(this.s=-1,0<h&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),r&&T.ZERO.subTo(this,this)}function l(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t}function c(t){if(this.s<0)return"-"+this.negate().toString(t);var i;if(16==t)i=4;else if(8==t)i=3;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return this.toRadix(t);i=2}var s,o=(1<<i)-1,r=!1,h="",n=this.t,e=this.DB-n*this.DB%i;if(0<n--)for(e<this.DB&&0<(s=this[n]>>e)&&(r=!0,h=u(s));0<=n;)e<i?(s=(this[n]&(1<<e)-1)<<i-e,s|=this[--n]>>(e+=this.DB-i)):(s=this[n]>>(e-=i)&o,e<=0&&(e+=this.DB,--n)),0<s&&(r=!0),r&&(h+=u(s));return r?h:"0"}function m(){var t=D();return T.ZERO.subTo(this,t),t}function v(){return this.s<0?this.negate():this}function y(t){var i=this.s-t.s;if(0!=i)return i;var s=this.t;if(0!=(i=s-t.t))return this.s<0?-i:i;for(;0<=--s;)if(0!=(i=this[s]-t[s]))return i;return 0}function d(t){var i,s=1;return 0!=(i=t>>>16)&&(t=i,s+=16),0!=(i=t>>8)&&(t=i,s+=8),0!=(i=t>>4)&&(t=i,s+=4),0!=(i=t>>2)&&(t=i,s+=2),0!=(i=t>>1)&&(t=i,s+=1),s}function b(){return this.t<=0?0:this.DB*(this.t-1)+d(this[this.t-1]^this.s&this.DM)}function S(t,i){for(var s=this.t-1;0<=s;--s)i[s+t]=this[s];for(s=t-1;0<=s;--s)i[s]=0;i.t=this.t+t,i.s=this.s}function B(t,i){for(var s=t;s<this.t;++s)i[s-t]=this[s];i.t=Math.max(this.t-t,0),i.s=this.s}function g(t,i){for(var s=t%this.DB,o=this.DB-s,r=(1<<o)-1,h=Math.floor(t/this.DB),n=this.s<<s&this.DM,e=this.t-1;0<=e;--e)i[e+h+1]=this[e]>>o|n,n=(this[e]&r)<<s;for(e=h-1;0<=e;--e)i[e]=0;i[h]=n,i.t=this.t+h+1,i.s=this.s,i.clamp()}function M(t,i){i.s=this.s;var s=Math.floor(t/this.DB);if(s>=this.t)i.t=0;else{var o=t%this.DB,r=this.DB-o,h=(1<<o)-1;i[0]=this[s]>>o;for(var n=s+1;n<this.t;++n)i[n-s-1]|=(this[n]&h)<<r,i[n-s]=this[n]>>o;0<o&&(i[this.t-s-1]|=(this.s&h)<<r),i.t=this.t-s,i.clamp()}}function R(t,i){for(var s=0,o=0,r=Math.min(t.t,this.t);s<r;)o+=this[s]-t[s],i[s++]=o&this.DM,o>>=this.DB;if(t.t<this.t){for(o-=t.s;s<this.t;)o+=this[s],i[s++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;s<t.t;)o-=t[s],i[s++]=o&this.DM,o>>=this.DB;o-=t.s}i.s=o<0?-1:0,o<-1?i[s++]=this.DV+o:0<o&&(i[s++]=o),i.t=s,i.clamp()}function A(t,i){var s=this.abs(),o=t.abs(),r=s.t;for(i.t=r+o.t;0<=--r;)i[r]=0;for(r=0;r<o.t;++r)i[r+s.t]=s.am(0,o[r],i,r,0,s.t);i.s=0,i.clamp(),this.s!=t.s&&T.ZERO.subTo(i,i)}function E(t){for(var i=this.abs(),s=t.t=2*i.t;0<=--s;)t[s]=0;for(s=0;s<i.t-1;++s){var o=i.am(s,i[s],t,2*s,0,1);(t[s+i.t]+=i.am(s+1,2*i[s],t,2*s+1,o,i.t-s-1))>=i.DV&&(t[s+i.t]-=i.DV,t[s+i.t+1]=1)}0<t.t&&(t[t.t-1]+=i.am(s,i[s],t,2*s,0,1)),t.s=0,t.clamp()}function V(t,i,s){var o=t.abs();if(!(o.t<=0)){var r=this.abs();if(r.t<o.t)return null!=i&&i.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=D());var h=D(),n=this.s,e=t.s,t=this.DB-d(o[o.t-1]);0<t?(o.lShiftTo(t,h),r.lShiftTo(t,s)):(o.copyTo(h),r.copyTo(s));var u=h.t,f=h[u-1];if(0!=f){var r=f*(1<<this.F1)+(1<u?h[u-2]>>this.F2:0),p=this.FV/r,a=(1<<this.F1)/r,l=1<<this.F2,c=s.t,m=c-u,v=null==i?D():i;for(h.dlShiftTo(m,v),0<=s.compareTo(v)&&(s[s.t++]=1,s.subTo(v,s)),T.ONE.dlShiftTo(u,v),v.subTo(h,h);h.t<u;)h[h.t++]=0;for(;0<=--m;){var y=s[--c]==f?this.DM:Math.floor(s[c]*p+(s[c-1]+l)*a);if((s[c]+=h.am(0,y,s,m,0,u))<y)for(h.dlShiftTo(m,v),s.subTo(v,s);s[c]<--y;)s.subTo(v,s)}null!=i&&(s.drShiftTo(u,i),n!=e&&T.ZERO.subTo(i,i)),s.t=u,s.clamp(),0<t&&s.rShiftTo(t,s),n<0&&T.ZERO.subTo(s,s)}}}function w(t){var i=D();return this.abs().divRemTo(t,null,i),this.s<0&&0<i.compareTo(T.ZERO)&&t.subTo(i,i),i}function O(t){this.m=t}function q(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t}function x(t){return t}function F(t){t.divRemTo(this.m,null,t)}function Z(t,i,s){t.multiplyTo(i,s),this.reduce(s)}function I(t,i){t.squareTo(i),this.reduce(i)}function C(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var i=3&t;return 0<(i=(i=(i=(i=i*(2-(15&t)*i)&15)*(2-(255&t)*i)&255)*(2-((65535&t)*i&65535))&65535)*(2-t*i%this.DV)%this.DV)?this.DV-i:-i}function j(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function N(t){var i=D();return t.abs().dlShiftTo(this.m.t,i),i.divRemTo(this.m,null,i),t.s<0&&0<i.compareTo(T.ZERO)&&this.m.subTo(i,i),i}function P(t){var i=D();return t.copyTo(i),this.reduce(i),i}function k(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var i=0;i<this.m.t;++i){var s=32767&t[i],o=s*this.mpl+((s*this.mph+(t[i]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[s=i+this.m.t]+=this.m.am(0,o,t,i,0,this.m.t);t[s]>=t.DV;)t[s]-=t.DV,t[++s]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)}function L(t,i){t.squareTo(i),this.reduce(i)}function z(t,i,s){t.multiplyTo(i,s),this.reduce(s)}function _(){return 0==(0<this.t?1&this[0]:this.s)}function G(t,i){if(4294967295<t||t<1)return T.ONE;var s,o=D(),r=D(),h=i.convert(this),n=d(t)-1;for(h.copyTo(o);0<=--n;)i.sqrTo(o,r),0<(t&1<<n)?i.mulTo(r,h,o):(s=o,o=r,r=s);return i.revert(o)}function H(t,i){i=new(t<256||i.isEven()?O:j)(i);return this.exp(t,i)}O.prototype.convert=q,O.prototype.revert=x,O.prototype.reduce=F,O.prototype.mulTo=Z,O.prototype.sqrTo=I,j.prototype.convert=N,j.prototype.revert=P,j.prototype.reduce=k,j.prototype.mulTo=z,j.prototype.sqrTo=L,T.prototype.copyTo=n,T.prototype.fromInt=f,T.prototype.fromString=a,T.prototype.clamp=l,T.prototype.dlShiftTo=S,T.prototype.drShiftTo=B,T.prototype.lShiftTo=g,T.prototype.rShiftTo=M,T.prototype.subTo=R,T.prototype.multiplyTo=A,T.prototype.squareTo=E,T.prototype.divRemTo=V,T.prototype.invDigit=C,T.prototype.isEven=_,T.prototype.exp=G,T.prototype.toString=c,T.prototype.negate=m,T.prototype.abs=v,T.prototype.compareTo=y,T.prototype.bitLength=b,T.prototype.mod=w,T.prototype.modPowInt=H,T.ZERO=p(0),T.ONE=p(1);var rt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ht="=";function nt(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}nt.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},nt.prototype.setPublic=function(t,i){null!=t&&null!=i&&0<t.length&&0<i.length?(this.n=new T(t,16),this.e=parseInt(i,16)):alert("Invalid RSA public key")},nt.prototype.encrypt=function(t){return null==(t=function(t,i){if(i<t.length+11)return alert("Message too long for RSA"),null;for(var s=new Array,o=t.length-1;0<=o&&0<i;)s[--i]=t[o--];s[--i]=0;for(var r=new it,h=new Array;2<i;){for(h[0]=0;0==h[0];)r.nextBytes(h);s[--i]=h[0]}return s[--i]=2,s[--i]=0,new T(s)}(t,this.n.bitLength()+7>>3))||null==(t=this.doPublic(t))?null:0==(1&(t=t.toString(16)).length)?t:"0"+t},nt.prototype.encrypt_b64=function(t){return(t=this.encrypt(t))?function(t){for(var i,s="",o=0;o+3<=t.length;o+=3)i=parseInt(t.substring(o,o+3),16),s+=rt.charAt(i>>6)+rt.charAt(63&i);for(o+1==t.length?(i=parseInt(t.substring(o,o+1),16),s+=rt.charAt(i<<2)):o+2==t.length&&(i=parseInt(t.substring(o,o+2),16),s+=rt.charAt(i>>2)+rt.charAt((3&i)<<4));0<(3&s.length);)s+=ht;return s}(t):null};const et=new nt;return et.setPublic(t,i),et.encrypt_b64(s)};

    /**
     * Encrypts an object with a random AES key, then uses the adyen public key provided to RSA encrypt the aes key
     * 
     * @function encrypt
     * 
     * @param {Object} data - Data to be encrypted
     */
    encrypt(data) {
        const aesKey = sjcl.random.randomWords(8, 6)
        const iv = sjcl.random.randomWords(3, 6)
        const aes = new sjcl.cipher.aes(aesKey)
        const cipher = sjcl.codec.base64.fromBits(sjcl.bitArray.concat(iv, sjcl.mode.ccm.encrypt(aes, sjcl.codec.utf8String.toBits(JSON.stringify(data)), iv)))
        const encrypted = this.rsaEncrypt(this.mod, this.exp, sjcl.codec.bytes.fromBits(aesKey))
        return [`adyenjs_${this.version}$`, encrypted, "$", cipher].join("");
    }
}

module.exports = AdyenEncrypt